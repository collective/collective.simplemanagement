<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="collective.simplemanagement">
  <head>
    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border',1);
                             disable_column_two python:request.set('disable_plone.rightcolumn',1);" />
  </head>
  <body metal:use-macro="content">

    <metal:bodytext fill-slot="main">
      <metal:main define-macro="main"
        tal:define="helpers context/@@sm_helpers;
                    employees view/employees;
                    employee_details view/employee_details">
        <div tal:replace="structure provider:plone.abovecontenttitle" />
        <h1 class="documentFirstHeading"
            i18n:translate=""
            tal:condition="not: employee_details">Your dashboard</h1>

        <h1 class="documentFirstHeading"
            tal:condition="employee_details"
            i18n:translate=""><span
              tal:replace="employee_details/fullname"
              i18n:name="username" /> dashboard</h1>

        <div tal:replace="structure provider:plone.abovecontentbody" />
        <div id="content-core">

          <tal:pm condition="view/user_can_manage_project">
            <metal:form
              use-macro="context/simpemanagement-macros/employee-form" />
          </tal:pm>

          <div id="overview">
            <ul class="tabs">
              <li><a href="dashboard#stories"
                i18n:translate="">Stories</a></li>
              <li><a href="dashboard#tickets"
                i18n:translate="">Tickets</a></li>
              <li><a href="dashboard#bookings"
                i18n:translate="">Booking</a></li>
            </ul>
            <div class="panes">
              <!-- Stories pane -->
              <div id="stories-wrapper"
                  class="pane"
                  tal:define="booking_holes view/booking_holes;
                             projects view/projects">
                <div id="missed-bookings"
                  class="pat-expose alert alert-top alert-booking"
                  data-expose-triggers="hover"
                  tal:condition="python: booking_holes and not employee_details">
                  <h2 i18n:translate="">Please complete your booking</h2>
                  <p class="claim"
                    i18n:translate="">You seem to have missing bookings
                    for the following days:</p>
                  <div class="listing">
                    <tal:row repeat="hole booking_holes">
                      <div tal:define="css_class string:row booking-hole;
                                       odd repeat/hole/odd;"
                           tal:attributes="class python:css_class + (odd and ' odd' or ' even')">
                        <div class="cell position-0 column-3">
                          <span class="booking-date"
                                tal:content="python:helpers.timeago(hole.date)" />
                        </div>
                        <div class="cell position-3 column-2">
                          <span class="booking-time"
                                i18n:translate="">
                            (<span i18n:name="time"
                                  tal:omit-tag=""
                                  tal:content="hole/time" />
                            hours booked)
                          </span>
                        </div>
                        <div class="cell position-6 column-4">
                          <div class="actions">
                            <span class="take-it-easy"
                                  i18n:translate="">It's okay, I</span>
                            <select class="hole-reasons"
                                    tal:attributes="name string:reason-${repeat/hole/number}">
                              <option i18n:translate="">- select reason -</option>
                              <option
                                tal:repeat="reason view/hole_reasons"
                                tal:attributes="value python:reason[0]"
                                tal:content="python:reason[1]" />
                            </select>
                            <button
                              disabled="disabled"
                              tal:attributes="data-time python:str(hole.time);
                                              data-date python:hole.date.strftime('%Y-%m-%d')"
                              class="create-hole"
                              i18n:translate="">
                              Fill it!
                            </button>
                          </div>
                        </div>
                      </div>
                    </tal:row>
                  </div>
                </div>

                <div id="projects"
                  tal:condition="not: projects">
                  <span class="label"
                    i18n:translate=""
                    tal:condition="employee_details">
                    There are not stories assigned to
                    <span tal:replace="employee_details/fullname"
                      i18n:name="username" />
                  </span>
                  <span class="label"
                    i18n:translate=""
                    tal:condition="not: employee_details">
                    There are not stories assigned to you.</span>
                </div>

                <div id="projects"
                  tal:condition="projects">
                  <div class="project" tal:repeat="project projects">
                    <h2>
                      <span>
                        <a tal:attributes="href project/url;
                           title string:priority: ${project/priority}">
                        <span tal:replace="project/title">Project #1</span>
                        </a>
                    </h2>
                    <table class="listing stories">
                      <thead>
                        <tr>
                          <th i18n:translate=""
                            colspan="2">Story</th>
                          <th i18n:translate="">Estimate</th>
                          <th i18n:translate="">Done</th>
                          <th i18n:translate=""
                            tal:condition="not: employee_details">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tal:stories repeat="story project/stories">
                          <metal:stories
                            use-macro="context/simpemanagement-macros/story-compact">

                            <metal:before-columns
                              fill-slot="before-columns" />
                            <metal:extra-info
                              fill-slot="extra-info" />

                            <metal:after-columns fill-slot="after-columns">
                              <td class="quick-booking"
                                tal:condition="not: employee_details">
                                <a i18n:translate=""
                                   class="bookform btn"
                                   title="Add Booking"
                                   i18n:attributes="title"
                                   tal:attributes="rel string:${story/url}/create_booking;
                                                   id string:bookform-${story/UID}">Book time</a>
                              </td>
                            </metal:after-columns>
                          </metal:stories>
                        </tal:stories>
                      </tbody>
                    </table>
                  </div>

                </div>

              </div>

              <!-- Tickets pane -->
              <div id="tickets-wrapper" class="pane"
                tal:define="results view/tickets">

                <p class="label" i18n:translate="">
                  Found
                  <span i18n:name="n_ticket"
                      tal:replace="view/n_tickets"></span>
                  ticket/s
                </p>

                <div class="project" tal:repeat="project results">
                  <h2>
                    <span>
                      <a tal:attributes="href project/url">
                        <span tal:content="project/priority"></span>
                      <span tal:replace="project/title">Project #1</span>
                      </a>
                  </h2>
                  <div class="tickets-wrapper"
                    tal:define="tickets project/tickets">
                    <metal:tickets
                      use-macro="context/simpemanagement-ticketsmacros/tickets" />
                  </div>
                </div>
              </div>

              <!-- Booking History pane -->
              <div id="booking-wrapper" class="pane"
                   tal:define="bookings view/bookings">

                <div tal:condition="not: bookings">
                  <span class="label"
                    i18n:translate=""
                    tal:condition="employee_details">
                    <span tal:replace="employee_details/fullname"
                      i18n:name="username" />
                    have no bookings yet
                  </span>

                  <span class="label"
                    i18n:translate=""
                    tal:condition="not: employee_details">
                    You have no bookings yet</span>
                </div>

                <table class="listing"
                  tal:condition="bookings">
                  <thead>
                    <tr>
                      <th i18n:translate="">Date</th>
                      <th i18n:translate="">Hours</th>
                      <th i18n:translate="">Title</th>
                      <th i18n:translate="">Projects</th>
                      <th i18n:translate="">Story</th>
                    </tr>
                  </thead>
                   <tbody>
                    <tr tal:repeat="book bookings">
                      <td><span
                          tal:content="book/date">today</span>
                           (<span class="discreet"
                            tal:content="book/date2" />)
                      </td>
                      <td tal:content="book/time">3.0</td>
                      <td><a tal:attributes="href book/url"
                             tal:content="book/title">closed ticket #1</a></td>
                      <td><a tal:content="book/project/title"
                             tal:attributes="href book/project/url">Project 1</a></td>
                      <td><a tal:content="book/story/title"
                             tal:attributes="href book/story/url">Story 1</a></td>
                    </tr>
                  </tbody>
                </table>

              </div>

            </div>
          </div>
        </div>

        <div id="booking-tooltip-form"
             tal:content="structure view/add_booking_form" />

        <div tal:replace="structure provider:plone.belowcontentbody" />
      </metal:main>
    </metal:bodytext>
  </body>
</html>
