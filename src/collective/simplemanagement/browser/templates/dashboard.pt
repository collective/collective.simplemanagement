<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="collective.simplemanagement">
  <head>
    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border',1);
                             disable_column_one python:request.set('disable_plone.leftcolumn',1);
                             disable_column_two python:request.set('disable_plone.rightcolumn',1);" />
  </head>
  <body metal:use-macro="content">

    <metal:bodytext fill-slot="main">
      <metal:main define-macro="main" tal:define="helpers context/@@simplemanagement_helpers;">
        <div tal:replace="structure provider:plone.abovecontenttitle" />
        <h1 class="documentFirstHeading">Dashboard</h1>
      <!-- <div tal:replace="structure provider:plone.belowcontenttitle" />     -->

        <div tal:replace="structure provider:plone.abovecontentbody" />
          <div id="content-core">

            <dl class="enableFormTabbing">
              <dt id="fieldsetlegend-stories"
                  i18n:translate="">Stories</dt>
              <dd id="fieldset-stories"
                  tal:define="booking_holes view/booking_holes;">
                <div id="missed-bookings"
                     tal:condition="booking_holes">
                  <h2 i18n:translate="">Please complete your booking</h2>
                  <p class="claim"
                    i18n:translate="">You seem to have missing bookings
                    for the following days:</p>
                  <div class="listing">
                    <div class="row booking-hole"
                         tal:repeat="hole booking_holes">
                      <div class="cell position-0 column-1">
                        <span class="booking-date"
                              tal:content="python:helpers.timeago(hole.date)" />
                      </div>
                      <div class="cell position-1 column-2">
                        <span class="booking-time" tal:content="hole/time" />
                      </div>
                      <div class="cell position-2 column-4">
                        <div class="actions">
                          <span class="take-it-easy"
                                i18n:translate="">It's okay, I</span>
                          <select class="hole-reasons"
                                  tal:attributes="name string:reason-${repeat/hole/number}">
                            <option i18n:translate="">- select reason -</option>
                            <option
                              tal:repeat="reason view/hole_reasons"
                              tal:attributes="value python:reason[0]"
                              tal:content="python:reason[1]" />
                          </select>
                          <button 
                            tal:attributes="data-time python:str(hole.time);
                                            data-date python:hole.date.strftime('%Y-%m-%d')"
                            class="create-hole"
                            i18n:translate="">
                            Fill it!
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="projects">
                  <div class="project" tal:repeat="project view/projects">
                    <h2>
                      <span>
                        <a tal:attributes="href project/url"
                          tal:content="project/priority"></a></span>
                        <span tal:replace="project/title">Project #1</span>
                    </h2>
                    <table class="listing stories">
                      <thead>
                        <tr>
                          <th i18n:translate="">Story</th>
                          <th i18n:translate="">Epic</th>
                          <th i18n:translate="">Milestone</th>
                          <th i18n:translate="">Estimate</th>
                          <th i18n:translate="">Done</th>
                          <th i18n:translate="">Difference</th>
                          <th i18n:translate="">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tal:stories repeat="story project/stories">
                          <metal:stories
                            use-macro="context/simpemanagement-macros/story-compact">
                            <metal:extra-info fill-slot="extra-info">
                              <td class="info">
                                <metal:story-epic
                                   use-macro="context/simpemanagement-macros/story-epic" />
                              </td>
                              <td class="info">
                                <metal:story-milestone
                                   use-macro="context/simpemanagement-macros/story-milestone" />
                              </td>
                            </metal:extra-info>
                            <metal:after-columns fill-slot="after-columns">
                              <td class="quick-booking">
                                <a i18n:translate="" class="bookform" title="NONE"
                                   tal:attributes="rel string:${story/url}/create_booking">Book time</a>
                              </td>
                            </metal:after-columns>
                          </metal:stories>
                        </tal:stories>
                      </tbody>
                    </table>
                  </div>

                </div>

              </dd>

              <dt id="fieldsetlegend-tickets"
                  i18n:translate="">Tickets</dt>
              <dd id="fieldset-tickets">
                <h2>TODO: Booking list</h2>
              </dd>

              <!-- Booking History -->
              <dt id="fieldsetlegend-booking"
                  i18n:translate="">Booking</dt>
              <dd id="fieldset-booking">

                <table class="listing">
                  <thead>
                    <tr>
                      <th i18n:translate="">Date</th>
                      <th i18n:translate="">Hours</th>
                      <th i18n:translate="">Title</th>
                      <th i18n:translate="">Projects</th>
                      <th i18n:translate="">Story</th>
                    </tr>
                  </thead>
<!--                   <tbody>
                    <tr tal:repeat="book view/bookings">
                      <td><a href=""
                          tal:content="book/date">today</a></td>
                      <td tal:content="book/time">3.0</td>
                      <td><a tal:attributes="href book/url"
                             tal:content="book/title">closed ticket #1</a></td>
                      <td><a tal:content="book/project/title"
                             tal:attributes="href book/project/url">Project 1</a></td>
                      <td><a tal:content="book/story/title"
                             tal:attributes="href book/story/url">Story 1</a></td>
                    </tr>
                  </tbody>
-->
                </table>

              </dd>
            </dl>
            <div id="booking-form" class="booking-form">
              <h2>Add booking</h2>
              <form method="post" action="" tal:attributes="action string:${context/absolute_url}/booking_json">
                <div class="field">
                  <label for="title">Title</label><br/>
                  <input type="text" id="title" name="title"
                         placeholder="title"/>
                </div>
                <div class="field">
                  <label for="description">Description</label><br/>
                  <input type="text" id="description" name="description"
                         placeholder="description"/>
                </div>
                <div class="field">
                  <label for="when">When</label><br/>
                  <input type="hidden" name="date" id="date" class="date"/>
                  <div class="datepicker"></div>
                </div>
                <div class="field">
                  <label for="time">Time spent</label><br/>
                  <input type="text" id="time" name="time" placeholder="timespent"/>
                </div>
                <!-- <div class="field">
                  <label for="reference">reference</label><br/>
                  <input type="text" id="reference" name="reference" placeholder="reference"/>
                </div> -->
                <input type="submit" name="book item" />
              </form>
          </div>
        <div tal:replace="structure provider:plone.belowcontentbody" />
      </metal:main>
    </metal:bodytext>
  </body>
</html>
